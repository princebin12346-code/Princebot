const moment = require("moment-timezone");

module.exports.config = {
  name: "autonotice_5waqt_simple",
  version: "1.0",
  author: "Mohammad Akash | Goat Bot Edition",
  role: 0,
  description: "à¦¦à§ˆà¦¨à¦¿à¦• à¦ªà¦¾à¦à¦š à¦“à§Ÿà¦¾à¦•à§à¦¤ à¦‡à¦¸à¦²à¦¾à¦®à¦¿à¦• à¦¨à§‹à¦Ÿà¦¿à¦¶ (à¦¸à¦®à§Ÿ/à¦¤à¦¾à¦°à¦¿à¦– à¦›à¦¾à§œà¦¾)",
  category: "namajtime"
};

module.exports.onLoad = async function ({ api }) {

  // ðŸ•Œ à¦“à§Ÿà¦¾à¦•à§à¦¤ à¦…à¦¨à§à¦¯à¦¾à§Ÿà§€ à¦Ÿà§à¦°à¦¿à¦—à¦¾à¦° à¦¸à¦®à§Ÿ (à¦¶à§à¦§à§ à¦šà§‡à¦• à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯)
  const waqtTimes = [
    { name: "à¦«à¦œà¦°", time: "05:17" },
    { name: "à¦¯à§‹à¦¹à¦°", time: "13:30" },
    { name: "à¦†à¦¸à¦°", time: "15:45" },
    { name: "à¦®à¦¾à¦—à¦°à¦¿à¦¬", time: "17:20" },
    { name: "à¦à¦¶à¦¾", time: "19:40" }
  ];

  let lastSent = {};

  console.log("ðŸ•‹ à§« à¦“à§Ÿà¦¾à¦•à§à¦¤ à¦‡à¦¸à¦²à¦¾à¦®à¦¿à¦• à¦¨à§‹à¦Ÿà¦¿à¦¶ (Simple) à¦šà¦¾à¦²à§ à¦¹à§Ÿà§‡à¦›à§‡");

  const sendNotice = async () => {
    const now = moment().tz("Asia/Dhaka");
    const today = now.format("YYYY-MM-DD");
    const currentTime = now.format("HH:mm");

    for (const w of waqtTimes) {
      const key = `${today}_${w.name}`;
      if (lastSent[key]) continue;

      if (currentTime >= w.time) {

        const message =
`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  ðŸ•Œ ${w.name} à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¨à§‹à¦Ÿà¦¿à¦¶
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ¤² à¦ªà§à¦°à¦¿à§Ÿ à¦®à§à¦¸à¦²à¦¿à¦® à¦­à¦¾à¦‡ à¦“ à¦¬à§‹à¦¨à§‡à¦°à¦¾ ðŸ¤²  

ðŸ•‹ à¦à¦–à¦¨ ${w.name} à¦¨à¦¾à¦®à¦¾à¦œ à¦†à¦¦à¦¾à§Ÿà§‡à¦° à¦¸à¦®à§Ÿ  
ðŸ“– à¦†à¦²à§à¦²à¦¾à¦¹à¦° à¦¡à¦¾à¦•à§‡ à¦¸à¦¾à§œà¦¾ à¦¦à¦¿à¦¨  
âœ¨ à¦¦à§à¦¨à¦¿à§Ÿà¦¾ à¦“ à¦†à¦–à¦¿à¦°à¦¾à¦¤à§‡à¦° à¦¸à¦«à¦²à¦¤à¦¾ à¦…à¦°à§à¦œà¦¨ à¦•à¦°à§à¦¨\n 

 à¦†à¦®à¦¾à¦¦à§‡à¦° à¦«à¦¾à¦‰à¦¨à§à¦¡à§‡à¦¶à¦¨à§‡\n à¦ªà§à¦°à¦¤à¦¿à¦¯à§‹à¦—à¦¿à¦¤à¦¾à¦° à¦†à¦¯à¦¼à§‹à¦œà¦¨ à¦•à¦°à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡\n\n à¦ªà§à¦°à¦¤à¦¿à¦¯à§‹à¦—à¦¿à¦¤à¦¾à¦° à¦¨à¦¾à¦®à¦ƒ à¦¤à¦¸à¦¬à§€à¦¹ à¦—à¦£à¦¨à¦¾\n\n à¦®à¦¾à¦¸ à¦¶à§‡à¦·à§‡ à¦¯à§‡ à¦¸à¦¬à¦šà§‡à¦¯à¦¼à§‡ à¦¬à§‡à¦¶à¦¿ à¦¤à¦¸à¦¬à¦¿ à¦—à§à¦¨à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡ à¦¤à¦¾à¦•à§‡ à¦«à¦¾à¦‰à¦¨à§à¦¡à§‡à¦¶à¦¨ à¦¥à§‡à¦•à§‡ à¦ªà§à¦°à¦¸à§à¦•à§ƒà¦¤ à¦•à¦°à¦¾ à¦¹à¦¬à§‡ðŸŽ\n à¦¬à¦¿à¦¸à§à¦¤à¦¾à¦°à¦¿à¦¤ à¦œà¦¾à¦¨à¦¤à§‡ à¦«à¦¾à¦‰à¦¨à§à¦¡à§‡à¦¶à¦¨ à¦•à§ƒà¦¤à¦ªà¦•à§à¦·à§‡ à¦¸à¦¾à¦¥à§‡ à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦— à¦•à¦°à§à¦¨ðŸ˜»

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ•‹ à¦†à¦¤-à¦¤à¦¾à¦•à§à¦¬à¦“à§Ÿà¦¾ à¦«à¦¾à¦‰à¦¨à§à¦¡à§‡à¦¶à¦¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;

        try {
          const threads = await api.getThreadList(100, null, ["INBOX"]);
          const groups = threads.filter(t => t.isGroup);

          for (const g of groups) {
            await api.sendMessage(message, g.threadID);
            await new Promise(r => setTimeout(r, 1200));
          }

          lastSent[key] = true;
          console.log(`âœ… ${w.name} à¦¨à§‹à¦Ÿà¦¿à¦¶ à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à§Ÿà§‡à¦›à§‡`);
        }
        catch (err) {
          console.error("âŒ Auto Notice Error:", err);
        }
      }
    }
  };

  // â±ï¸ à¦ªà§à¦°à¦¤à¦¿ à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡ à¦šà§‡à¦• à¦•à¦°à¦¬à§‡
  setInterval(sendNotice, 60 * 1000);
};

module.exports.onStart = () => {};
