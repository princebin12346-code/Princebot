const moment = require("moment-timezone");

module.exports.config = {
  name: "autohadis_dan",
  version: "1.0",
  author: "Mohammad Akash | Goat Bot Edition",
  role: 0,
  description: "à¦ªà§à¦°à¦¤à¦¿ à¦˜à¦£à§à¦Ÿà¦¾à§Ÿ à¦¦à¦¾à¦¨/à¦¸à¦¦à¦•à¦¾ à¦¬à¦¿à¦·à§Ÿà¦• à¦¹à¦¾à¦¦à¦¿à¦¸ à¦ªà¦¾à¦ à¦¾à¦¬à§‡",
  category: "AutoTime"
};

module.exports.onLoad = async function ({ api }) {

  // ðŸ•Œ à¦¦à¦¾à¦¨ à¦“ à¦¸à¦¦à¦•à¦¾ à¦¬à¦¿à¦·à§Ÿà¦• à§§à§¨à¦Ÿà¦¿ à¦¹à¦¾à¦¦à¦¿à¦¸
  const hadithList = [
    "â à¦¸à¦¦à¦•à¦¾ à¦¸à¦®à§à¦ªà¦¦ à¦•à¦®à¦¾à§Ÿ à¦¨à¦¾à¥¤ âž â€” à¦¸à¦¹à¦¿à¦¹ à¦®à§à¦¸à¦²à¦¿à¦®",
    "â à¦‰à¦¤à§à¦¤à¦® à¦¸à¦¦à¦•à¦¾ à¦¹à¦²à§‹ à¦¯à¦¾ à¦…à¦­à¦¾à¦¬à¦®à§à¦•à§à¦¤ à¦…à¦¬à¦¸à§à¦¥à¦¾à§Ÿ à¦¦à§‡à¦“à§Ÿà¦¾ à¦¹à§Ÿà¥¤ âž â€” à¦¸à¦¹à¦¿à¦¹ à¦¬à§à¦–à¦¾à¦°à¦¿",
    "â à¦†à¦—à§à¦¨ à¦¥à§‡à¦•à§‡ à¦¬à¦¾à¦à¦šà§‹, à¦…à¦°à§à¦§à§‡à¦• à¦–à§‡à¦œà§à¦° à¦¸à¦¦à¦•à¦¾ à¦•à¦°à§‡à¦“ à¦¯à¦¦à¦¿ à¦¹à§Ÿà¥¤ âž â€” à¦¬à§à¦–à¦¾à¦°à¦¿ à¦“ à¦®à§à¦¸à¦²à¦¿à¦®",
    "â à¦—à§‹à¦ªà¦¨ à¦¸à¦¦à¦•à¦¾ à¦†à¦²à§à¦²à¦¾à¦¹à¦° à¦•à§à¦°à§‹à¦§ à¦¨à¦¿à¦­à¦¿à§Ÿà§‡ à¦¦à§‡à§Ÿà¥¤ âž â€” à¦¤à¦¿à¦°à¦®à¦¿à¦œà¦¿",
    "â à¦¸à¦¦à¦•à¦¾ à¦¬à¦¿à¦ªà¦¦ à¦†à¦ªà¦¦ à¦¦à§‚à¦° à¦•à¦°à§‡à¥¤ âž â€” à¦¤à¦¾à¦¬à¦°à¦¾à¦¨à¦¿",
    "â à¦¦à¦¾à¦¨à¦•à¦¾à¦°à§€ à¦†à¦²à§à¦²à¦¾à¦¹à¦° à¦¨à¦¿à¦•à¦Ÿ à¦ªà§à¦°à¦¿à§Ÿà¥¤ âž â€” à¦¤à¦¾à¦¬à¦°à¦¾à¦¨à¦¿",
    "â à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¿à¦¨ à¦¸à¦•à¦¾à¦²à§‡ à¦«à§‡à¦°à§‡à¦¶à¦¤à¦¾ à¦¬à¦²à§‡â€”à¦¹à§‡ à¦†à¦²à§à¦²à¦¾à¦¹! à¦¦à¦¾à¦¨à¦•à¦¾à¦°à§€à¦•à§‡ à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¾à¦¨ à¦¦à¦¾à¦“à¥¤ âž â€” à¦¬à§à¦–à¦¾à¦°à¦¿",
    "â à¦¸à¦¦à¦•à¦¾ à¦•à¦¿à§Ÿà¦¾à¦®à¦¤à§‡à¦° à¦¦à¦¿à¦¨ à¦›à¦¾à§Ÿà¦¾ à¦¹à¦¬à§‡à¥¤ âž â€” à¦†à¦¹à¦®à¦¾à¦¦",
    "â à¦¦à¦°à¦¿à¦¦à§à¦°à¦•à§‡ à¦¦à¦¾à¦¨ à¦•à¦°à¦¾ à¦¸à¦¦à¦•à¦¾à¥¤ âž â€” à¦®à§à¦¸à¦²à¦¿à¦®",
    "â à¦†à¦¤à§à¦®à§€à§Ÿà¦•à§‡ à¦¦à¦¾à¦¨ à¦•à¦°à¦²à§‡ à¦¦à§à¦¬à¦¿à¦—à§à¦£ à¦¸à¦“à§Ÿà¦¾à¦¬à¥¤ âž â€” à¦¨à¦¾à¦¸à¦¾à¦ˆ",
    "â à¦‰à¦¤à§à¦¤à¦® à¦¦à¦¾à¦¨ à¦¤à¦¾-à¦‡ à¦¯à¦¾ à¦¨à¦¿à¦œà§‡à¦° à¦ªà§à¦°à§Ÿà§‹à¦œà¦¨à§‡à¦° à¦®à¦¾à¦à§‡à¦“ à¦•à¦°à¦¾ à¦¹à§Ÿà¥¤ âž â€” à¦¬à§à¦–à¦¾à¦°à¦¿",
    "â à¦†à¦²à§à¦²à¦¾à¦¹ à¦¸à¦¦à¦•à¦¾ à¦—à§à¦°à¦¹à¦£ à¦•à¦°à§‡à¦¨ à¦à¦¬à¦‚ à¦¤à¦¾ à¦¬à§ƒà¦¦à§à¦§à¦¿ à¦•à¦°à§‡à¦¨à¥¤ âž â€” à¦¸à¦¹à¦¿à¦¹ à¦®à§à¦¸à¦²à¦¿à¦®"
  ];

  let index = 0;
  let lastSentHour = null;

  console.log("ðŸ•’ Goat Bot Auto Hadith (à¦¦à¦¾à¦¨) à¦šà¦¾à¦²à§ à¦¹à§Ÿà§‡à¦›à§‡");

  const sendHadith = async () => {
    const now = moment().tz("Asia/Dhaka");
    const hour = now.format("HH");
    const minute = now.format("mm");

    // à¦¶à§à¦§à§ à¦˜à¦£à§à¦Ÿà¦¾à¦° à¦¶à§à¦°à§à¦¤à§‡ à¦à¦•à¦¬à¦¾à¦°
    if (minute !== "00" || lastSentHour === hour) return;
    lastSentHour = hour;

    const time = now.format("hh:mm A");
    const date = now.format("DD-MM-YYYY");

    let period = "à¦­à§‹à¦°";
    const h = parseInt(hour);
    if (h >= 4 && h < 12) period = "à¦¸à¦•à¦¾à¦²";
    else if (h >= 12 && h < 17) period = "à¦¦à§à¦ªà§à¦°";
    else if (h >= 17 && h < 20) period = "à¦¬à¦¿à¦•à§‡à¦²";
    else if (h >= 20) period = "à¦°à¦¾à¦¤";

    const hadith = hadithList[index];
    index = (index + 1) % hadithList.length;

    const message =
`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
ðŸ•’ à¦¸à¦®à§Ÿ: ${period} ${time}
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“– à¦¦à¦¾à¦¨ à¦¸à¦®à§à¦ªà¦°à§à¦•à¦¿à¦¤ à¦¹à¦¾à¦¦à¦¿à¦¸  
${hadith}

ðŸ“… à¦¤à¦¾à¦°à¦¿à¦–: ${date}

ðŸ“Œà¦‡à¦¸à¦²à¦¾à¦®à¦¿à¦• à¦ªà§‹à¦¸à§à¦Ÿ à¦ªà§‡à¦¤à§‡ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦«à§‡à¦¸à¦¬à§à¦• à¦ªà§‡à¦œà§‡ à¦¯à§à¦•à§à¦¤ à¦¥à¦¾à¦•à§à¦¨  
ðŸ‘‰ https://www.facebook.com/YourPageLinkHere

ðŸ•‹ à¦†à¦¤-à¦¤à¦¾à¦•à§à¦¬à¦“à§Ÿà¦¾ à¦«à¦¾à¦‰à¦¨à§à¦¡à§‡à¦¶à¦¨ ðŸ•‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;

    try {
      const threads = await api.getThreadList(100, null, ["INBOX"]);
      const groups = threads.filter(t => t.isGroup);

      for (const g of groups) {
        await api.sendMessage(message, g.threadID);
      }

    } catch (e) {
      console.log("âŒ Auto Hadith Error:", e);
    }
  };

  // â±ï¸ à¦ªà§à¦°à¦¤à¦¿ à§©à§¦ à¦¸à§‡à¦•à§‡à¦¨à§à¦¡à§‡ à¦šà§‡à¦•
  setInterval(sendHadith, 30 * 1000);
};

module.exports.onStart = () => {};
